---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
library(npi)
library(tibble)
data("npis")
nyc <- npis
```

# npi <img src="man/figures/logo.png" align="right" height="139" />

> Access the U.S. National Provider Identifier Registry API
  
<!-- badges: start -->
  [![Project Status: Active â€“ The project has reached a stable, usable state and is being actively developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)
  [![lifecycle](https://img.shields.io/badge/lifecycle-maturing-blue.svg)](https://lifecycle.r-lib.org/articles/stages.html)
  [![R-CMD-check](https://github.com/frankfarach/npi/workflows/R-CMD-check/badge.svg)](https://github.com/frankfarach/npi/actions)
  [![Coverage status](https://codecov.io/gh/frankfarach/npi/branch/master/graph/badge.svg)](https://codecov.io/github/frankfarach/npi?branch=master)
  [![DOI](https://zenodo.org/badge/122857655.svg)](https://zenodo.org/badge/latestdoi/122857655)
<!-- badges: end -->

Use R to access the U.S. National Provider Identifier (NPI) Registry API (v2.1) by the Center for Medicare and Medicaid Services (CMS): https://npiregistry.cms.hhs.gov/. Obtain rich administrative data linked to a specific individual or organizational healthcare provider, or perform advanced searches based on provider name, location, type of service, credentials, and many other attributes. `npi` provides convenience functions for data extraction so you can spend less time wrangling data and more time putting data to work.

Analysts working with healthcare and public health data frequently need to join data from multiple sources to answer their business or research questions. Unfortunately, joining data in healthcare is hard because so few entities have unique, consistent identifiers across organizational boundaries. NPI numbers, however, do not suffer from these limitations, as all U.S. providers meeting certain common criteria must have an NPI number in order to be reimbursed for the services they provide. This makes NPI numbers incredibly useful for joining multiple datasets by provider, which is the primary motivation for developing this package.

## Installation

Install `npi` directly from Github using the `devtools` package:

```{r install, eval = FALSE}
devtools::install_github("frankfarach/npi")
library(npi)
```

## Usage

`npi` exports four functions, all of which match the pattern "npi_*":

 * `npi_search()`: Search the NPI Registry and return the response as a [tibble](https://tibble.tidyverse.org/) with high-cardinality data organized into list columns.
 * `npi_summarize()`: A method for displaying a nice overview of results from `npi_search()`.
 * `npi_flatten()`: A method for flattening one or more list columns from a search result, joined by NPI number.
 * `npi_is_valid()`: Check the validity of one or more NPI numbers using the official [NPI enumeration standard](https://www.cms.gov/Regulations-and-Guidance/Administrative-Simplification/NationalProvIdentStand/Downloads/NPIcheckdigit.pdf).

### Search the registry

`npi_search()` exposes nearly all of the NPPES API's [search parameters](https://npiregistry.cms.hhs.gov/registry/help-api). Let's say we wanted to find up to 10 organizational providers with primary locations in New York City:

```{r, eval = FALSE}
nyc <- npi_search(city = "New York City")
```
```{r print-nyc}
# Your results may differ since the data in the NPPES database changes over time
nyc
```

The full search results have four regular vector columns, `npi`, `enumeration_type`, `created_date`, and `last_updated_date` and seven list columns. Each list column is a collection of related data:

 * `basic`: Basic profile information about the provider
 * `other_names`: Other names used by the provider
 * `identifiers`: Other provider identifiers and credential information
 * `taxonomies`: Service classification and license information
 * `addresses`: Location and mailing address information
 * `practice_locations`: Provider's practice locations
 * `endpoints`: Details about provider's endpoints for health information exchange

A full list of the possible fields within these list columns can be found on the [NPPES API Help page](https://npiregistry.cms.hhs.gov/registry/Json-Conversion-Field-Map).

If you're comfortable [working with list columns](https://r4ds.had.co.nz/many-models.html), this may be all you need from the package. But let's not stop just yet, because `npi` provides convenience functions to summarize and extract the data you need.

## Working with search results 

Run `npi_summarize()` on your results to see a more human-readable overview of what we've got. Specifically, the function returns the NPI number, provider's name, enumeration type (individual or organizational provider), primary address, phone number, and primary taxonomy (area of practice):

```{r summarize-nyc}
npi_summarize(nyc)
```

Suppose we just want the basic and taxonomy information for each NPI in the result in a flattened data frame:

```{r flatten-two}
npi_flatten(nyc, c("basic", "taxonomies"))
```

Or we can flatten the whole thing and prune back later:

```{r flatten-all}
npi_flatten(nyc)
```

Now we're ready to do whatever else we need to do with this data. Under the hood, `npi_flatten()` has done a lot of data wrangling for us:

  * unnested the specified list columns
  * avoided potential naming collisions by prefixing the unnested names by their originating column name
  * joined the data together by NPI

### Validating NPIs

Just like credit card numbers, NPI numbers can be mistyped or corrupted in transit. Likewise, officially-issued NPI numbers have a [check digit](https://en.wikipedia.org/wiki/Check_digit) for error-checking purposes. Use `npi_is_valid()` to check whether an NPI number you've encountered is [validly constructed](https://www.cms.gov/Regulations-and-Guidance/Administrative-Simplification/NationalProvIdentStand/Downloads/NPIcheckdigit.pdf):

```{r valid_npi_ex}
# Validate off NPIs
npi_is_valid(1234567893)
npi_is_valid(1234567898)
```

Note that this function doesn't check whether the NPI numbers are activated or deactivated (see [#22](https://github.com/frankfarach/npi/issues/22#issuecomment-787642817)). It merely checks for the number's consistency with the NPI specification. As such, it can help you detect data quality issues early.

## Set your own user agent

A [user agent](https://en.wikipedia.org/wiki/User_agent) is a way for the software interacting with an API to tell it who or what is making the request. This helps the API's maintainers understand what systems are using the API. By default, when `npi` makes a request to the NPPES API, the request header references the name of the package and the URL for the repository (e.g., '`r paste(paste0("npi/", utils::packageVersion("npi")), "(http://github.com/frankfarach/npi)")`'). If you want to set a custom user agent, update the value of the `npi_user_agent` option. For example, for version 1.0.0 of an app called "my_app", you could run the following code:

```{r, eval = FALSE}
options(npi_user_agent = "my_app/1.0.0")
```

## Package Website

`npi` has a [website](https://frankfarach.github.io/npi/) with release notes, documentation on all user functions, and examples showing how the package can be used.

## Reporting Bugs

Did you spot a bug? I'd love to hear about it at the [issues page](https://github.com/frankfarach/npi/issues).

## Code of Conduct

Please note that this project is released with a [Contributor Code of Conduct](CODE_OF_CONDUCT.md). By participating in this project you agree to abide by its terms.

## Contributing

Interested in learning how you can contribute to npi? Head over to the [contributor guide](CONTRIBUTING.md)&mdash;and thanks for considering!

## How to cite this package

For the latest citation, see the [Authors and Citation](https://frankfarach.github.io/npi/authors.html#citation) page on the package website.

## License

MIT (c) [Frank Farach](https://github.com/frankfarach)

This package's logo is licensed under [CC BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/deed.en) and co-created by [Frank Farach](https://github.com/frankfarach) and [Sam Parmar](https://github.com/parmsam). The logo uses a modified version of an [image](https://commons.wikimedia.org/wiki/File:Rod_of_Asclepius_(Search).svg) of the [Rod of Asclepius](https://en.wikipedia.org/wiki/Rod_of_Asclepius) and a magnifying glass that is attributed to Evanherk, GFDL.
